<?phpClass Image extends CI_Controller {	function index()	{	  $this->load->model('setting_m');	  		$src = addslashes(strip_tags($_GET['src']));		$GID = (int) addslashes(strip_tags($_GET['gid']));		if(!$src || !$GID) 			header( "HTTP/1.0 404 Not Found" );		 // Where did you actually put your images?		  // Make sure that the path you put below ends with		  // a directory slash ("/"). The script below assumes it.		  $imagedir = CUSTOMER_IMAGE_DIR.$GID.'/';		  // What are the websites (hostnames) that can use this		  // image?		  // If your site can be accessed with or without the		  // "www" prefix, make sure you put both here. Do not put		  // any trailing slashes ("/") nor any "http://" prefixes.		  // Follow the example below.		  $url_meta = parse_url($this->setting_m->get('SITE_URL'));		  $url_meta_no_www = str_replace("www.","",$url_meta['host']);		  $validprefixes = array (			$url_meta['host'],			$url_meta_no_www		  );		  // What is the main page of your website? Visitors will		  // be directed here if they type		  //   "http://www.example.com/chimage.php"		  // in their browser.		  $homepage = $this->setting_m->get('APP_FANPAGE');		  //----------------------- main program -----------------------		  $image = $src;		  $referrer = getenv( "HTTP_REFERER" );		  if (isset($src)) {			if (empty($referrer) ||			  $this->isreferrerokay( $referrer, $validprefixes )) {			  $imagepath = $imagedir . $image ;			  $imageinfo = getimagesize( $imagepath );			  if ($imageinfo[2] == 1) {				$imagetype = "gif" ;			  }			  elseif ($imageinfo[2] == 2) {				$imagetype = "jpeg" ;			  }			  elseif ($imageinfo[2] == 3) {				$imagetype = "png" ;			  }			  else {				header( "HTTP/1.0 404 Not Found" );				exit ;			  }			  header( "Content-type: image/$imagetype" );			  @readfile( $imagepath );			  exit;			}			else {			  header( "HTTP/1.0 404 Not Found" );			}		  }		  else {			header( "Location: $homepage" );		  }	}		private function isreferrerokay ( $referrer, $validprefixes )		  {			$validreferrer = 0 ;			$authreferrer  = current( $validprefixes );			while ($authreferrer) {			  if (preg_match( "/^https?:\/\/$authreferrer\//i", $referrer )) {				$validreferrer = 1 ;				break ;			  }			  $authreferrer = next( $validprefixes );			}			return $validreferrer ;		  }		function campaign()	{	  $this->load->model('setting_m');	  		$src = addslashes(strip_tags($_GET['src']));		if(!$src) 			header( "HTTP/1.0 404 Not Found" );		 // Where did you actually put your images?		  // Make sure that the path you put below ends with		  // a directory slash ("/"). The script below assumes it.		  $imagedir = CAMPAIGN_IMAGE_DIR.'/';		  // What are the websites (hostnames) that can use this		  // image?		  // If your site can be accessed with or without the		  // "www" prefix, make sure you put both here. Do not put		  // any trailing slashes ("/") nor any "http://" prefixes.		  // Follow the example below.		  $url_meta = parse_url($this->setting_m->get('SITE_URL'));		  $url_meta_no_www = str_replace("www.","",$url_meta['host']);		  $validprefixes = array (			$url_meta['host'],			$url_meta_no_www		  );		  // What is the main page of your website? Visitors will		  // be directed here if they type		  //   "http://www.example.com/chimage.php"		  // in their browser.		  $homepage = $this->setting_m->get('APP_FANPAGE');		  //----------------------- main program -----------------------		  $image = $src;		  $referrer = getenv( "HTTP_REFERER" );		  if (isset($src)) {			if (empty($referrer) ||			  $this->isreferrerokay( $referrer, $validprefixes )) {			  $imagepath = $imagedir . $image ;			  $imageinfo = getimagesize( $imagepath );			  if ($imageinfo[2] == 1) {				$imagetype = "gif" ;			  }			  elseif ($imageinfo[2] == 2) {				$imagetype = "jpeg" ;			  }			  elseif ($imageinfo[2] == 3) {				$imagetype = "png" ;			  }			  else {				header( "HTTP/1.0 404 Not Found" );				exit ;			  }			  header( "Content-type: image/$imagetype" );			  @readfile( $imagepath );			  exit;			}			else {			  header( "HTTP/1.0 404 Not Found" );			}		  }		  else {			header( "Location: $homepage" );		  }	}	}